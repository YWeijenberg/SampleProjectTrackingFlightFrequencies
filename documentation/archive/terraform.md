A problem occurs when destroying and re-applying infrastructure, especially the key vault. Because the key vault has a default soft delete option, the keyvault and its contents will be recovered which leads to an error when terraform wants to re-create the secrets inside the keyvault. This could have been fixed by disabling purge protection, or disabling soft-delete. However, soft-delete will be enabled on all keyvaults starting from februari 2025. It could be possible to purge on soft delete, which is set to true by default on the keyvault and its secrets/keys. However, since I disabled purge protection, the purge after soft delete that is set to true should result in a correct removal of the secrets. As a workaround i disabled recover_soft_deleted_key_vaults and recover_soft_deleted_secrets.

After testing, apparently setting recover to off leads to an error where terraform states that there is a soft-deleted keyvault but that it can not be retrieved because this setting is turned off. Turning the auto-recover back on as it was in the beginning leads to correct execution of terraform apply. I'll retest a whole destroy and apply operation with this enabled to see if it works now.

After running terraform apply from scratch in the first run we get a problem with access denied to the secrets. If we rerun apply we can see that the secrets weren't created. However, on a second run the secrets are created and everything is deployted. Why this is the case is not clear. 

